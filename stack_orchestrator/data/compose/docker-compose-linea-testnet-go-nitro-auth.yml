version: '3.7'

services:
  go-nitro-alice:
    image: cerc/go-nitro:local
    hostname: go-nitro-alice
    restart: on-failure
    depends_on:
      - go-nitro-bootnode
    env_file:
      - ../config/linea-testnet-go-nitro-auth/alice.env
    entrypoint: ["bash", "-c", "/app/run-nitro-node.sh"]
    volumes:
      - nitro_deployment:/app/deployment
      - go_nitro_data_alice:/app/data
      - ../config/go-nitro/run-nitro-node.sh:/app/run-nitro-node.sh
    healthcheck:
      test: ["CMD", "nc", "-vz", "localhost", "4006"]
      interval: 5s
      timeout: 5s
      retries: 100
      start_period: 100s
    ports:
      - "3006:3006"
      - "4006:4006"
      - "5006:5006"
      - "4106:4106"
      - "4206:4206"
      - "4216:4216"

  go-nitro-bob:
    image: cerc/go-nitro:local
    hostname: go-nitro-bob
    restart: on-failure
    depends_on:
      - go-nitro-bootnode
    env_file:
      - ../config/linea-testnet-go-nitro-auth/bob.env
    entrypoint: ["bash", "-c", "/app/run-nitro-node.sh"]
    volumes:
      - nitro_deployment:/app/deployment
      - go_nitro_data_bob:/app/data
      - ../config/go-nitro/run-nitro-node.sh:/app/run-nitro-node.sh
    healthcheck:
      test: ["CMD", "nc", "-vz", "localhost", "4007"]
      interval: 5s
      timeout: 5s
      retries: 100
      start_period: 100s
    ports:
      - "3007:3007"
      - "4007:4007"
      - "5007:5007"
      - "4107:4107"
      - "4207:4207"
      - "4217:4217"

  go-nitro-bootnode:
    image: cerc/go-nitro:local
    hostname: go-nitro-bootnode
    restart: on-failure
    env_file:
      - ../config/linea-testnet-go-nitro-auth/bootnode.env
    entrypoint: [ "bash", "-c", "/app/run-nitro-node.sh" ]
    volumes:
      - nitro_deployment:/app/deployment
      - go_nitro_data_bootnode:/app/data
      - ../config/go-nitro/run-nitro-node.sh:/app/run-nitro-node.sh
    healthcheck:
      test: [ "CMD", "nc", "-vz", "localhost", "4008" ]
      interval: 5s
      timeout: 5s
      retries: 100
      start_period: 100s

  nitro-caddy:
    image: caddy:2-alpine
    restart: always
    volumes:
      - ../config/linea-testnet-go-nitro-auth/caddy/Caddyfile:/etc/caddy/Caddyfile
    ports:
      - "5678:80"
    depends_on:
      - go-nitro-alice
      - go-nitro-bob

volumes:
  go_nitro_data_alice:
  go_nitro_data_bob:
  go_nitro_data_bootnode:
  nitro_deployment:
