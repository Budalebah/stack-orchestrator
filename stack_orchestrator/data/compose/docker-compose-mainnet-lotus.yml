volumes:
  parameters:
  lotus-repo:
  lotus_miner_data:
  lotus_shared:

services:
  lotus:
    environment:
      - LOTUS_API_LISTENADDRESS=/ip4/0.0.0.0/tcp/1234/http
      - LOTUS_LIBP2P_LISTENADDRESSES:
        - "/ip4/0.0.0.0/tcp/1235"
        - "/ip6/::/tcp/1235"
        - "/ip4/0.0.0.0/udp/1235/quic-v1"
        - "/ip6/::/udp/1235/quic-v1"
        - "/ip4/0.0.0.0/udp/1235/quic-v1/webtransport"
        - "/ip6/::/udp/1235/quic-v1/webtransport"
    image: cerc/lotus-mainnet:local
    volumes:
      - parameters:/var/tmp/filecoin-proof-parameters
      - lotus-repo:/var/lib/lotus
      - lotus_shared:/root/.lotus
      - lotus_miner_data:/root/data
    ports:
      - "1234"
      - "1235"
    deploy:
      restart_policy:
        condition: on-failure
        delay: 30s
    entrypoint: ["sh", "/docker-lotus-entrypoint.sh"]
